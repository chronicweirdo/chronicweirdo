<!DOCTYPE html>

<html>
<head>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta charset="utf-8"/>
<link href="favicon.png?" rel="shortcut icon" type="image/x-icon"/>
    <style>
        #content {
            text-align: center;
        }
        img {
            margin: 0 auto;
            max-width: 100%;
        }
        #left {
            position: fixed;
            width: 20%;
            height: 100%;
            left: 0;
            top: 0;
        }
        #right {
            position: fixed;
            width: 20%;
            height: 100%;
            right: 0;
            top: 0;
        }
        #center {
            position: fixed;
            width: 60%;
            height: 100%;
            left: 20%;
            top: 0;
        }
    </style>
    <script>
        function getPixelKey(pixelData) {
            return pixelData[0] + "_" + pixelData[1] + "_" + pixelData[2]
        }

        function getKeyColor(key) {
            var cs = key.split("_")
            return [parseInt(cs[0]), parseInt(cs[1]), parseInt(cs[2])]
        }

        function increaseRepresentation(pixelMap, pixelData) {
            var k = getPixelKey(pixelData)
            //console.log(k)
            if (pixelMap[k] !== undefined) {
                pixelMap[k] = pixelMap[k] + 1
            } else {
                pixelMap[k] = 1
            }
        }

        function getMostRepresented(pixelMap) {
            var total = 0
            var items = Object.keys(pixelMap).map(function(key) {
                total = total + pixelMap[key]
                return [key, pixelMap[key]];
            })
            items.sort(function(first, second) {
                return second[1] - first[1];
            });

            // select items based on representation (difference in representation)
            var color = getKeyColor(items[0][0])
            var selectedColors = [[color, items[0][1]]]
            var selectedColorsNumber = 1
            for (var i = 1; i < items.length && (items[i][1] / items[0][1] > .1); i++) {
                var additionalColor = getKeyColor(items[i][0])
                selectedColors.push([additionalColor, items[i][1]])
                color[0] = color[0] + additionalColor[0]
                color[1] = color[1] + additionalColor[1]
                color[2] = color[2] + additionalColor[2]
                selectedColorsNumber = i
            }
            //console.log(selectedColors)
            color[0] = Math.floor(color[0] / selectedColorsNumber)
            color[1] = Math.floor(color[1] / selectedColorsNumber)
            color[2] = Math.floor(color[2] / selectedColorsNumber)

            //var key = items[0][0]
            //var cs = key.split("_")
            //return [parseInt(cs[0]), parseInt(cs[1]), parseInt(cs[2])]
            return color
        }
        function invert(color) {
            return [
                255 - color[0],
                255 - color[1],
                255 - color[2]
            ]
        }
        function getTextColor(bg) {
            // Counting the perceptive luminance - human eye favors green color... 
            var luminance = ( 0.299 * bg[0] + 0.587 * bg[1] + 0.114 * bg[2])/255;

            if (luminance > 0.5) {
                return [0, 0, 0]
            } else {
                return [255, 255, 255]
            }
        }
        function getImage() {
            var content = document.getElementById("content")
            var img = content.getElementsByTagName("img")[0]
            //console.log(img)
            return img
        }
        function getOriginalImageWidth() {
            return getImage().naturalWidth
        }
        function getOriginalImageHeight() {
            return getImage().naturalHeight
        }
        function getSuggestedBackgroundColor() {
            var img = getImage()
            var canvas = document.createElement('canvas');
            canvas.width = getOriginalImageWidth()
            canvas.height = getOriginalImageHeight()
            //console.log(canvas.width)
            //console.log(canvas.height)
            var context = canvas.getContext('2d')
            context.drawImage(img, 0, 0)
            var pixelMap = {}
            // firefox disable cors for testing
            // about:config
            // security.fileuri.strict_origin_policy
            // console.log(context.getImageData(0, 0, 1, 1).data)
            for (var y = 0; y < getOriginalImageHeight(); y++) {
                increaseRepresentation(pixelMap, context.getImageData(0, y, 1, 1).data)
                increaseRepresentation(pixelMap, context.getImageData(getOriginalImageWidth() - 1, y, 1, 1).data)
            }
            for (var x = 1; x < getOriginalImageWidth() - 1; x++) {
                increaseRepresentation(pixelMap, context.getImageData(x, 0, 1, 1).data)
                increaseRepresentation(pixelMap, context.getImageData(x, getOriginalImageHeight() - 1, 1, 1).data)
            }
            //console.log(pixelMap)
            var color = getMostRepresented(pixelMap)

            document.body.style.background="rgb(" + color[0] + "," + color[1] + "," + color[2] + ")"
            //var textColor = invert(color)
            var textColor = getTextColor(color)
            //console.log(textColor)
            document.body.style.color="rgb(" + textColor[0] + "," + textColor[1] + "," + textColor[2] + ")"
            canvas.remove()
        }

        var data = [
        "2011/2011.04.02.06.00.00.png",
"2011/2011.04.03.06.00.00.png",
"2011/2011.04.03.07.00.00.png",
"2011/2011.04.03.08.00.00.png",
"2011/2011.05.30.06.00.00.png",
"2011/2011.06.24.06.00.00.png",
"2011/2011.07.02.06.00.00.png",
"2011/2011.07.26.06.00.00.png",
"2011/2011.08.22.06.00.00.png",
"2011/2011.08.23.06.00.00.png",
"2011/2011.09.03.06.00.00.png",
"2011/2011.11.10.06.00.00.png",
"2011/2011.12.06.06.00.00.png",
"2011/2011.12.07.06.00.00.png",
"2011/2011.12.08.06.00.00.png",
"2011/2011.12.10.06.00.00.png",
"2011/2011.12.29.06.00.00.png",
"2012/2012.04.22.06.00.00.png",
"2012/2012.04.22.07.00.00.png",
"2012/2012.04.22.08.00.00.png",
"2012/2012.04.22.09.00.00.png",
"2012/2012.04.22.10.00.00.png",
"2012/2012.06.14.06.00.00.png",
"2012/2012.10.22.10.35.31.png",
"2012/2012.10.22.11.03.00.png",
"2012/2012.10.22.11.12.00.png",
"2012/2012.10.22.11.13.00.png",
"2012/2012.10.23.08.53.00.png",
"2012/2012.10.24.09.48.00.png",
"2012/2012.10.25.08.00.00.png",
"2012/2012.10.26.08.00.00.png",
"2012/2012.10.29.08.01.00.png",
"2012/2012.10.30.08.00.00.png",
"2012/2012.10.31.08.01.00.png",
"2012/2012.11.01.08.00.00.png",
"2012/2012.11.02.08.00.00.png",
"2012/2012.11.04.09.16.00.png",
"2012/2012.11.05.08.00.00.png",
"2012/2012.11.06.08.00.00.png",
"2012/2012.11.07.08.00.00.png",
"2012/2012.11.08.08.00.00.png",
"2012/2012.11.08.08.01.00.png",
"2012/2012.11.09.08.00.00.png",
"2012/2012.11.15.08.30.00.png",
"2012/2012.11.16.08.30.33.png",
"2012/2012.11.19.08.30.40.png",
"2012/2012.11.21.08.30.00.png",
"2012/2012.12.19.15.20.00.png",
"2012/2012.12.20.08.56.04.png",
"2012/2012.12.21.06.49.00.png",
"2012/2012.12.22.08.01.00.png",
"2012/2012.12.29.15.09.00.png",
"2012/2012.12.31.10.48.00.png",
"2013/2013.01.07.08.30.25.png",
"2013/2013.01.10.08.30.00.png",
"2013/2013.01.12.08.30.00.png",
"2013/2013.02.01.12.13.00.png",
"2013/2013.02.11.21.29.00.png",
"2013/2013.02.16.10.17.00.png",
"2013/2013.03.04.22.00.00.png",
"2013/2013.03.07.14.30.00.png",
"2013/2013.03.09.06.17.06.jpg",
"2013/2013.03.10.09.34.00.png",
"2013/2013.03.16.16.10.00.png",
"2013/2013.03.16.16.10.01.png",
"2013/2013.03.16.16.10.02.png",
"2013/2013.03.16.16.10.03.png",
"2013/2013.03.26.09.14.00.png",
"2013/2013.03.31.10.28.00.png",
"2013/2013.03.31.21.14.00.png",
"2013/2013.04.11.13.04.00.png",
"2013/2013.04.18.15.02.00.naivity.jpg",
"2013/2013.04.24.22.26.00.solutions.for.sad.things.png",
"2013/2013.06.01.20.33.00.boring.nature.png",
"2013/2013.09.01.11.30.00.png",
"2013/2013.09.07.22.12.00.png",
"2013/2013.09.07.22.12.01.png",
"2013/2013.09.07.22.12.02.png",
"2013/2013.09.07.22.12.03.png",
"2013/2013.09.07.22.12.04.png",
"2013/2013.09.07.22.12.05.png",
"2013/2013.09.08.09.28.14.png",
"2013/2013.10.01.22.17.00.join.the.future.png",
"2013/2013.12.04.20.32.29.true.story.jpg",
"2013/2013.12.19.16.47.10.png",
"2013/2013.12.22.16.02.32.png",
"2013/2013.12.26.15.56.00.fashion.png",
"2014/2014.01.13.22.38.57.antibirthday.png",
"2014/2014.01.16.02.39.56.no.story.png",
"2014/2014.01.16.21.15.24.a.little.less.png",
"2014/2014.01.26.00.12.13.first.contact.png",
"2014/2014.02.07.23.12.31.png",
"2014/2014.02.08.22.20.12.personality.disorder.0.png",
"2014/2014.02.08.22.20.12.personality.disorder.1.png",
"2014/2014.04.13.14.33.42.povesti.degeaba.png",
"2014/2014.04.13.14.34.28.povesti.degeaba.png",
"2014/2014.04.14.09.01.13.povesti.degeaba.png",
"2014/2014.04.15.09.01.06.povesti.degeaba.png",
"2014/2014.04.16.07.55.50.povesti.degeaba.png",
"2014/2014.10.08.17.49.36.png",
"2014/2014.12.25.11.35.59.jpg",
"2014/2014.12.31.09.56.57.png",
"2014/2014.12.31.18.30.18.joke.complete.png",
"2015/2015.01.03.10.01.29.jpg",
"2015/2015.01.11.10.47.00.subtlety.png",
"2015/2015.01.17.20.04.00.png",
"2015/2015.02.14.01.02.00.png",
"2015/2015.02.14.01.02.01.png",
"2015/2015.05.07.20.01.35.well.sad.png",
"2015/2015.07.17.13.28.54.i.dont.think.this.helps.png",
"2015/2015.08.13.11.58.46.sinking.into.thought.png",
"2015/2015.08.14.10.19.27.png",
"2015/2015.09.09.09.01.08.png",
"2015/2015.09.09.21.13.28.apple.event.png",
"2015/2015.11.20.12.56.37.tincu.wisdom.gif",
"2016-2017/2016.04.01.23.45.13.png",
"2016-2017/2017.02.24.23.12.06.a.star.is.born.png",
"2016-2017/2017.09.01.21.25.02.png",
"2018/2018.03.04.08.12.30.toilet.humor.png",
"2018/2018.03.05.08.18.06.jpg",
"2018/2018.03.07.08.37.14.jpg",
"2018/2018.03.09.08.19.03.jpg",
"2018/2018.03.13.07.58.44.seduction.jpg",
"2018/2018.03.16.11.04.30.happy.end.friday.jpg",
"2018/2018.03.19.08.46.18.jpg",
"2018/2018.03.28.fun.happens.jpg",
"2018/2018.03.29.18.22.37.jpg",
"2018/2018.03.31.17.04.03.jpg",
"2018/2018.03.31.22.17.09.jpg",
"2018/2018.04.03.17.13.58.calm.mp4",
"2018/2018.04.03.17.13.58.calm.thumb.png",
"2018/2018.04.05.07.06.23.png",
"2018/2018.04.10.11.25.00.jpg",
"2018/2018.04.12.08.09.22.emergency.jpg",
"2018/2018.04.16.17.11.45.the.spot.jpg",
"2018/2018.04.28.07.10.57.png",
"2018/2018.05.02.08.18.41.jpg",
"2018/2018.05.04.14.43.20.jpg",
"2018/2018.05.09.07.07.20.jpg",
"2018/2018.05.17.14.34.17.jpg",
"2018/2018.05.26.08.23.11.uplifting.jpg",
"2018/2018.05.27.escape.collection.jpg",
"2018/2018.06.04.08.56.03.jpg",
"2018/2018.06.09.12.19.32.jpg",
"2018/2018.06.11.jpg",
"2018/2018.06.17.firefight.png",
"2018/2018.06.21.10.25.34.jpg",
"2018/2018.06.24.jpg",
"2018/2018.06.28.win.jpg",
"2018/2018.07.05.jpg",
"2018/2018.07.06.water.weight.jpg",
"2018/2018.07.07.headloss.jpg",
"2018/2018.07.09.08.39.14.mp4",
"2018/2018.07.09.08.39.14.thumb.png",
"2018/2018.07.14.jpg",
"2018/2018.07.22.conspiracy.pack.png",
"2018/2018.07.27.blood.mars.2.jpg",
"2018/2018.07.27.blood.mars.jpg",
"2018/2018.08.06.pappje.jpg",
"2018/2018.08.18.20.13.jpg",
"2018/2018.08.18.jpg",
"2018/2018.08.22.jpg",
"2018/2018.08.24.11.22.jpg",
"2018/2018.08.24.16.20.authentic.impasta.jpg",
"2018/2018.08.25.13.29.jpg",
"2018/2018.08.26.10.08.jpg",
"2018/2018.08.26.10.50.hidden.elevator.jpg",
"2018/2018.08.27.13.51.jpg",
"2018/2018.08.27.15.15.jpg",
"2018/2018.08.27.16.44.play.math.jpg",
"2018/2018.08.27.21.36.jpg",
"2018/2018.08.28.20.24.ghost.ship.jpg",
"2018/2018.08.29.06.35.jpg",
"2018/2018.08.29.11.22.jpg",
"2018/2018.08.29.11.23.fun.in.the.making.jpg",
"2018/2018.08.30.11.50.jpg",
"2018/2018.08.30.12.45.jpg",
"2018/2018.08.30.14.40.jpg",
"2018/2018.09.03.jpg",
"2018/2018.09.07.16.16.mp4",
"2018/2018.09.07.16.16.thumb.png",
"2018/2018.09.10.14.51.jpg",
"2018/2018.09.10.16.44.jpg",
"2018/2018.09.14.13.31.jpg",
"2018/2018.09.15.19.10.jpg",
"2018/2018.09.26.jpg",
"2018/2018.09.27.18.20.jpg",
"2018/2018.09.27.18.34.jpg",
"2018/2018.html",
"2018/20181111.jpg",
"2018/20181112.jpg",
"2018/20181212.png",
"2019/20190114.jpg",
"2019/20190127.jpg",
"2019/20190131.jpg",
"2019/20190202.jpg",
"2019/20190209.jpg",
"2019/20190213.jpg",
"2019/20190217.jpg",
"2019/20190305.jpg",
"2019/20190322.2.jpg",
"2019/20190322.jpg",
"2019/20190406.2.jpg",
"2019/20190406.jpg",
"2019/20190407.jpg",
"2019/20190408.jpg",
"2019/20190410.jpg",
"2019/20190516.jpg",
"2019/20190617.jpg",
"2019/20190622.jpeg",
"2019/20190629.jpeg",
"2019/20190708.jpeg",
"2019/20190710.jpeg",
"2019/20190712.jpeg",
"2019/20190717.jpeg",
"2019/201906151.jpg",
"2019/201906152.jpg",
"2019/201906153.jpg",
"2019/201907211312.jpeg",
"2019/201907211317.jpeg",
"2019/201908022105.jpeg",
"2019/201908031730.jpeg",
"2019/201908031753.jpeg",
"2019/201908031754.jpeg",
"2019/201908111710.jpeg",
"2019/201908151914.jpeg",
"2019/201908182226.jpeg",
"2019/201908252101.jpeg",
"2019/201908252102.jpeg",
"2019/201909071040.jpeg",
"2019/201909261355.jpeg",
"2019/201909261405.jpeg",
"2019/201910301104.jpeg",
"2020/2020.png",
"2020/20201028.png"
        ]
        var current = data.length - 1
        function load(index) {
            var img = document.createElement("img")
            img.src = data[index]
            var content = document.getElementById("content")
            content.innerHTML = ""
            content.appendChild(img)
            img.onload = function() {
                getSuggestedBackgroundColor()
            }
        }
        function previous() {
            if (current > 0) {
                current = current - 1
                load(current)
            }
        }
        function next() {
            if (current < data.length - 1) {
                current = current + 1
                load(current)
            }
        }
    </script>
    <title>chronicweirdo</title>
</head>
<body>
<!--nav>
<a onclick="next()">next</a>
<a onclick="previous()">previous</a>
</nav-->
<div id="content">

</div>
<div id="left" onclick="next()"></div>
<div id="center"></div>
<div id="right" onclick="previous()"></div>
<script>
    //document.getElementById("left").addEventListener("click", (event) => next())
    //document.getElementById("right").addEventListener("click", (event) => next())
    load(current)
</script>
</body>
</html>
